---
import MyLayout from "../layouts/MyLayout.astro";
import BlogPost from "../components/BlogPost.astro";
const allPosts = await Astro.glob("../pages/posts/*.md");
---

<MyLayout title="Home">
  <script
    slot="script"
    src="https://identity.netlify.com/v1/netlify-identity-widget.js"
  ></script>

  <main>
    <section class="main-section">
      <h1>Klrfl's Blog</h1>
      <p>I want to learn Astro, that's why I made this blog.</p>
      <p>
        Soo, I got bored of learning Vue and reading about stuff regarding
        front-end web development. Long story short, I heard of Astro and I want
        to be able to make blogs. So, here we are.
      </p>
    </section>

    <section class="main-section blogs">
      <h2>My recent blogs</h2>

      <ul class="blog-list">
        {allPosts.map((post) => <BlogPost post={post} />)}
      </ul>

      <a href="/blogs">See more of my blogs</a>
    </section>
  </main>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", (user) => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</MyLayout>
